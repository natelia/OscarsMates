<main class="mates-page">
  <div class="container mx-auto px-4 py-6">
    <%# Header %>
    <header class="text-center mb-4">
      <h1 class="page-title mb-2">
        <i data-lucide="users" class="mr-2 text-muted"></i>
        Oscar Mates
      </h1>
      <p class="text-muted">
        <%= pluralize(@users.size, 'mate') %> tracking <%= @year %> nominees
      </p>
    </header>

    <%# Filter Toggle %>
    <div class="text-center mb-4">
      <div class="inline-flex flex-wrap items-center gap-2" role="group" aria-label="Filter users">
        <% if params[:filter] == 'all' %>
          <%= link_to users_path, class: "btn-outline-oscar" do %>
            <i data-lucide="heart" class="text-muted"></i> Following
          <% end %>
          <span class="btn-oscar">
            <i data-lucide="users" class="text-muted"></i> All Mates
          </span>
        <% else %>
          <span class="btn-oscar">
            <i data-lucide="heart" class="text-muted"></i> Following
          </span>
          <%= link_to users_path(filter: 'all'), class: "btn-outline-oscar" do %>
            <i data-lucide="users" class="text-muted"></i> All Mates
          <% end %>
        <% end %>
      </div>
    </div>

    <% if @users.any? %>
      <%# Top Watchers Podium %>
      <%= render 'top_watchers',
          top_watchers: @top_watchers,
          total_movies: @total_movies_count,
          year: @year %>

      <%# Users Section %>
      <% users_to_show = params[:filter] == 'all' ? @remaining_users : @users %>

      <% if users_to_show.any? %>
        <h4 class="mb-4 text-center text-muted">
          <i data-lucide="grid" class="mr-2 text-muted"></i>
          <%= params[:filter] == 'all' ? 'All Mates' : 'Following' %>
        </h4>

        <div class="mates-grid">
          <% users_to_show.each_with_index do |user, index| %>
            <div class="animate-fade-in-up animate-delay-<%= [index + 1, 12].min %>">
              <%= render 'mate_card',
                  user: user,
                  total_movies: @total_movies_count,
                  year: @year,
                  current_user: current_user,
                  rank: nil %>
            </div>
          <% end %>
        </div>
      <% end %>

    <% else %>
      <%# Empty State %>
      <div class="empty-state">
        <div class="empty-icon">
          <i data-lucide="users" class="text-muted"></i>
        </div>
        <h3>No mates found</h3>
        <p>
          <% if params[:filter] != 'all' %>
            You're not following anyone yet. Start following mates to see them here!
          <% else %>
            Be the first to join the Oscar watching party!
          <% end %>
        </p>
        <% if params[:filter] != 'all' %>
          <%= link_to users_path(filter: 'all'), class: "btn-oscar" do %>
            <i data-lucide="users" class="mr-1 text-muted"></i> Browse All Mates
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</main>
