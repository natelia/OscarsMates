<main class="mates-page">
  <div class="container py-4">
    <%# Header %>
    <header class="text-center mb-4">
      <h1 class="page-title mb-2">
        <i class="bi bi-people-fill me-2"></i>
        Oscar Mates
      </h1>
      <p class="text-muted">
        <%= pluralize(@users.size, 'mate') %> tracking <%= @year %> nominees
      </p>
    </header>

    <%# Filter Toggle %>
    <div class="text-center mb-4">
      <div class="btn-group" role="group" aria-label="Filter users">
        <% if params[:filter] == 'followed' %>
          <%= link_to users_path, class: "btn btn-outline-oscar" do %>
            <i class="bi bi-people"></i> All Mates
          <% end %>
          <span class="btn btn-oscar">
            <i class="bi bi-heart-fill"></i> Following
          </span>
        <% else %>
          <span class="btn btn-oscar">
            <i class="bi bi-people"></i> All Mates
          </span>
          <%= link_to users_path(filter: 'followed'), class: "btn btn-outline-oscar" do %>
            <i class="bi bi-heart"></i> Following
          <% end %>
        <% end %>
      </div>
    </div>

    <% if @users.any? %>
      <%# Top Watchers Podium (only show when not filtering) %>
      <% unless params[:filter] == 'followed' %>
        <%= render 'top_watchers',
            top_watchers: @top_watchers,
            total_movies: @total_movies_count,
            year: @year %>
      <% end %>

      <%# All Mates Section %>
      <% users_to_show = params[:filter] == 'followed' ? @users : @remaining_users %>

      <% if users_to_show.any? %>
        <% unless params[:filter] == 'followed' %>
          <h4 class="mb-4 text-center text-muted">
            <i class="bi bi-grid me-2"></i>
            All Mates
          </h4>
        <% end %>

        <div class="mates-grid">
          <% users_to_show.each_with_index do |user, index| %>
            <div class="animate-fade-in-up animate-delay-<%= [index + 1, 12].min %>">
              <%= render 'mate_card',
                  user: user,
                  total_movies: @total_movies_count,
                  year: @year,
                  current_user: current_user,
                  rank: params[:filter] == 'followed' ? nil : (index + 4) %>
            </div>
          <% end %>
        </div>
      <% end %>

    <% else %>
      <%# Empty State %>
      <div class="empty-state">
        <div class="empty-icon">
          <i class="bi bi-people"></i>
        </div>
        <h3>No mates found</h3>
        <p>
          <% if params[:filter] == 'followed' %>
            You're not following anyone yet. Start following mates to see them here!
          <% else %>
            Be the first to join the Oscar watching party!
          <% end %>
        </p>
        <% if params[:filter] == 'followed' %>
          <%= link_to users_path, class: "btn btn-oscar" do %>
            <i class="bi bi-people me-1"></i> Browse All Mates
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</main>
