<section class="movie-details py-10">
  <div class="container mx-auto px-4">
    <div class="mx-auto max-w-4xl">

        <!-- Movie Card -->
        <div class="rounded-xl border border-slate-200 bg-white shadow-sm">
          <div class="grid gap-6 md:grid-cols-[1fr_2fr]">

            <!-- Movie Picture -->
            <div class="h-full w-full overflow-hidden rounded-t-xl md:rounded-l-xl md:rounded-tr-none">
              <img src="<%= @movie.picture_url %>" class="h-full w-full object-cover" alt="<%= @movie.title %>">
            </div>

            <!-- Movie Details -->
            <div class="px-6 pb-6 pt-2 md:pt-6">
              <h2 class="text-xl sm:text-2xl font-semibold text-slate-900"><%= @movie.title %></h2>
              <h4 class="mt-1 text-sm font-medium text-muted"><%= @movie.english_title %></h4>
              <div class="mt-4 space-y-2 text-sm text-slate-700">
                <p><span class="font-semibold text-slate-900">Where to watch:</span> <%= @movie.where_to_watch %></p>
                <p><span class="font-semibold text-slate-900">IMDB Rating:</span> <%= @movie.rating %></p>
                <p><span class="font-semibold text-slate-900">Runtime:</span> <%= @movie.runtime %> mins</p>
              </div>
              <a href="<%= @movie.url %>" class="mt-4 btn-outline-oscar btn-sm" target="_blank">Details</a>

                <!-- Genres -->
                <% if @genres.present? %>
                  <div class="mt-4 flex flex-wrap gap-2">
                    <% @genres.each do |genre| %>
                      <span class="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-700"><%= genre.name %></span>
                    <% end %>
                  </div>
                <% end %>
            </div>
          </div>
        </div>

        <!-- Categories -->
        <% if @categories.present? %> 
          <div class="mt-4 flex flex-wrap gap-2">
            <% @categories.each do |category| %>
              <span class="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-700"><%= category.name %></span>
            <% end %>
          </div>
        <% end %>

        <!-- Reviews and Actions -->
        <div class="mt-6">
          <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
            <div class="flex flex-wrap items-center gap-2 text-sm">
              <%= average_stars(@movie) %>
              <%= link_to pluralize(@movie.reviews.size, "review"), movie_reviews_path(@movie, year: params[:year]), class: "text-slate-600 hover:text-slate-900" %>
            </div>

            <% if current_user %>
              <div class="flex flex-wrap items-center gap-3">
                <%= fave_or_unfave_button(@movie, @favorite) %>
                <span class="text-sm text-slate-600"><%= @fans.size %></span>

                <% if @fans.present? %>
                  <div class="relative">
                    <button class="btn-outline-oscar btn-sm" type="button" data-hs-collapse="#fansList" aria-expanded="false" aria-controls="fansList">
                      Mates who liked
                    </button>
                    <div class="hs-collapse hidden mt-2 rounded-lg border border-slate-200 bg-white shadow-sm" id="fansList">
                      <ul class="divide-y divide-slate-200 text-sm text-slate-700">
                        <% @fans.each do |user| %>
                          <li class="px-4 py-2">
                            <%= link_to user.name, user_path(user), class: "hover:text-slate-900" %>
                          </li>
                        <% end %>
                      </ul>
                    </div>
                  </div>
                <% end %>
                <%= watch_or_unwatch_button(@movie, @review) %>
              </div>
            <% end %>
          </div>
        </div>

        <!-- Additional Actions -->
        <ul class="mt-6 space-y-3">
          <li>
            <%= link_to "Home Page", movies_path(year: params[:year]), class: "btn-outline-oscar w-full justify-center" %>
          </li>

          <% if current_user_admin? %>
            <li>
              <%= link_to "Edit", edit_movie_path(@movie, year: params[:year]), class: "btn-outline-oscar w-full justify-center" %>
            </li>
            <li>
              <%= link_to "Destroy", movie_path(@movie, year: params[:year]), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "btn-danger w-full justify-center" %>
            </li>
          <% end %>
        </ul>

      </div>
    </div>
  </div>
</section>

